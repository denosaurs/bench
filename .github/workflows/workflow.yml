# This workflow was automatically generated by tool/workflow.ts
# Please do not edit manually, instead run deno task workflow

name: bench
"on":
  schedule:
    - cron: 0 0 * * *
  push:
    paths:
      - "**.ts"
      - "**.js"
      - "**.tsx"
      - "**.jsx"
      - "**.yml"
      - "**.json"
      - "!frameworks/*/results/*.json"
jobs:
  hello_bench:
    name: "Hello, bench!"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false
          fetch-depth: 0
      - name: Install Deno
        uses: denoland/setup-deno@v1
      - name: Install Node
        uses: actions/setup-node@v3
      - name: Install Bun
        uses: antongolub/action-setup-bun@v1.4.0
      - name: Install Oha
        uses: baptiste0928/cargo-install@v1
        with:
          crate: oha
          version: 0.5.5
      - name: Run Benchmark
        run: deno task benchmark hello_bench
      - name: Save hello_bench results
        id: hello_bench-results
        uses: actions/cache@v3
        with:
          path: frameworks/*/results/hello_bench.json
          key: "hello_bench-results-${{ github.run_id }}"
  finish:
    name: Finish
    runs-on: ubuntu-latest
    needs:
      - hello_bench
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false
          fetch-depth: 0
      - name: Load hello_bench results
        id: hello_bench-results
        uses: actions/cache@v3
        with:
          path: frameworks/*/results/hello_bench.json
          key: "hello_bench-results-${{ github.run_id }}"
      - name: Install Deno
        uses: denoland/setup-deno@v1
      - name: Generate README.md
        run: deno task readme
      - name: Push changes
        uses: actions-js/push@v1
        with:
          github_token: "${{ secrets.GITHUB_TOKEN }}"
          branch: main
